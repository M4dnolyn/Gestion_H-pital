Creating test database for alias 'default' ('test_gestion_hopital')...
Found 4 test(s).
Operations to perform:
  Synchronize unmigrated apps: corsheaders, django_filters, messages, rest_framework, runserver_nostatic, staticfiles
  Apply all migrations: accounts, admin, auth, authtoken, billing, config, contenttypes, medical, personnes, planning, rh, services, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
Running migrations:
  Applying personnes.0001_initial... OK
  Applying contenttypes.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0001_initial... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying accounts.0001_initial... OK
  Applying accounts.0002_alter_user_id... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying authtoken.0001_initial... OK
  Applying authtoken.0002_auto_20160226_1747... OK
  Applying authtoken.0003_tokenproxy... OK
  Applying authtoken.0004_alter_tokenproxy_options... OK
  Applying billing.0001_initial... OK
  Applying billing.0002_alter_facture_id_alter_factureprestation_id_and_more... OK
  Applying config.0001_initial... OK
  Applying planning.0001_initial... OK
  Applying medical.0001_initial... OK
  Applying medical.0002_alter_consultation_id_alter_ordonnance_id... OK
  Applying personnes.0002_personnel_user... OK
  Applying planning.0002_alter_rendezvous_id... OK
  Applying services.0001_initial... OK
  Applying rh.0001_initial... OK
  Applying rh.0002_alter_conge_id_alter_personnelservice_id... OK
  Applying sessions.0001_initial...test_patient_detail_view (personnes.tests.PatientTests.test_patient_detail_view)
Test that patient detail loads correctly ... FAIL
test_patient_list_view (personnes.tests.PatientTests.test_patient_list_view)
Test that patient list loads correctly ... ok
test_patient_model (personnes.tests.PatientTests.test_patient_model)
Test Patient model creation and string representation ... ok
test_personnel_creation (personnes.tests.PersonnelTests.test_personnel_creation) ... ok

======================================================================
FAIL: test_patient_detail_view (personnes.tests.PatientTests.test_patient_detail_view)
Test that patient detail loads correctly
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/m4dnolyn/Gestion_H-pital/backend/personnes/tests.py", line 55, in test_patient_detail_view
    self.assertContains(response, "O+")
AssertionError: False is not true : Couldn't find 'O+' in the following response
b'<!DOCTYPE html>\n<html lang="fr">\n\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>D\xc3\xa9tail Patient - Doe</title>\n\n  <!-- Bootstrap 5 -->\n  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />\n  <!-- Font Awesome -->\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />\n  <!-- Chart.js -->\n  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>\n\n  <style>\n    :root {\n      --hospital-primary: #2c3e50;\n      --hospital-secondary: #3498db;\n      --hospital-success: #27ae60;\n      --hospital-warning: #f39c12;\n      --hospital-danger: #e74c3c;\n      --hospital-info: #17a2b8;\n    }\n\n    .hospital-sidebar {\n      background-color: var(--hospital-primary);\n      min-height: 100vh;\n      color: white;\n    }\n\n    .hospital-nav-link {\n      color: #ecf0f1;\n      padding: 12px 20px;\n      border-left: 4px solid transparent;\n      transition: all 0.3s;\n      text-decoration: none;\n      display: block;\n    }\n\n    .hospital-nav-link:hover,\n    .hospital-nav-link.active {\n      background-color: rgba(255, 255, 255, 0.1);\n      border-left-color: var(--hospital-secondary);\n      color: white;\n    }\n\n    .stat-card {\n      border-radius: 10px;\n      transition: transform 0.3s;\n    }\n\n    .stat-card:hover {\n      transform: translateY(-5px);\n    }\n\n    .badge-trend-up {\n      background-color: var(--hospital-success);\n    }\n\n    .badge-trend-down {\n      background-color: var(--hospital-danger);\n    }\n\n    .badge-trend-neutral {\n      background-color: var(--hospital-info);\n    }\n\n    /* Style pour le bouton de d\xc3\xa9connexion dans le formulaire */\n    .logout-form button {\n      background: none;\n      border: none;\n      width: 100%;\n      text-align: left;\n      padding: 0;\n    }\n\n    .logout-form button:hover {\n      background: none;\n    }\n\n    /* Styles d\'impression pour PDF propre */\n    @media print {\n\n      /* Masquer la navigation et les \xc3\xa9l\xc3\xa9ments UI */\n      .hospital-sidebar,\n      .sidebar,\n      nav,\n      .breadcrumb,\n      .no-print,\n      button,\n      .btn,\n      footer {\n        display: none !important;\n      }\n\n      /* Supprimer les marges et paddings du container */\n      .container-fluid,\n      .row {\n        margin: 0 !important;\n        padding: 0 !important;\n        width: 100% !important;\n        max-width: 100% !important;\n      }\n\n      /* Contenu principal en pleine largeur */\n      .col-md-10,\n      .col-lg-10,\n      main {\n        width: 100% !important;\n        max-width: 100% !important;\n        margin: 0 !important;\n        padding: 20px !important;\n      }\n\n      /* Fond blanc pour l\'impression */\n      body {\n        background-color: white !important;\n      }\n\n      /* Supprimer les ombres et bordures */\n      .card {\n        box-shadow: none !important;\n      }\n    }\n  </style>\n\n  \n</head>\n\n<body>\n  \n  <div class="container-fluid">\n    <div class="row">\n      <!-- Sidebar -->\n      <div class="col-md-2 col-lg-2 d-md-block hospital-sidebar sidebar collapse show" id="sidebar">\n        <div class="position-sticky pt-3">\n          <!-- Logo et titre -->\n          <div class="text-center mb-4 pt-3">\n            <h4 class="text-white">\n              <i class="fas fa-hospital"></i>\n              <span class="d-none d-md-inline">H\xc3\xb4pital Manager</span>\n            </h4>\n            <small class="text-muted">Syst\xc3\xa8me de Gestion</small>\n          </div>\n\n          <!-- Navigation -->\n          <ul class="nav flex-column mb-auto">\n            <li class="nav-item">\n              <a href="/dashboard/"\n                class="nav-link hospital-nav-link ">\n                <i class="fas fa-tachometer-alt me-2"></i>\n                <span class="d-none d-md-inline">Tableau de bord</span>\n              </a>\n            </li>\n\n            <li class="nav-item">\n              <a href="/personnes/patients/" class="nav-link hospital-nav-link">\n                <i class="fas fa-users me-2"></i>\n                <span class="d-none d-md-inline">Patients</span>\n              </a>\n            </li>\n\n            \n\n            \n            <li class="nav-item">\n              <a href="/rendezvous/" class="nav-link hospital-nav-link">\n                <i class="fas fa-calendar-alt me-2"></i>\n                <span class="d-none d-md-inline">Rendez-vous</span>\n              </a>\n            </li>\n            \n\n            \n            <li class="nav-item">\n              <a href="/medical/consultations/" class="nav-link hospital-nav-link">\n                <i class="fas fa-stethoscope me-2"></i>\n                <span class="d-none d-md-inline">Consultations</span>\n              </a>\n            </li>\n            \n\n            \n\n            \n\n            \n\n            <li class="nav-item">\n              <a href="/personnes/proches/" class="nav-link hospital-nav-link">\n                <i class="fas fa-hands-helping me-2"></i>\n                <span class="d-none d-md-inline">Proches Aidants</span>\n              </a>\n            </li>\n\n            <hr class="text-white-50 my-3" />\n\n            <li class="nav-item">\n              <a href="/admin/" class="nav-link hospital-nav-link">\n                <i class="fas fa-cog me-2"></i>\n                <span class="d-none d-md-inline">Administration</span>\n              </a>\n            </li>\n\n            \n\n            <!-- D\xc3\x89CONNEXION CORRIG\xc3\x89E - Formulaire POST -->\n            <li class="nav-item logout-form">\n              <form method="post" action="/accounts/logout/" class="d-inline w-100">\n                <input type="hidden" name="csrfmiddlewaretoken" value="o8KmvHC7IV3o5CZM2iHOC0s2aSntkgFNqSmTPbOCWvZa8zKDopgyBAF6FDZAsH9O">\n                <button type="submit" class="nav-link hospital-nav-link text-danger w-100 text-start">\n                  <i class="fas fa-sign-out-alt me-2"></i>\n                  <span class="d-none d-md-inline">D\xc3\xa9connexion</span>\n                </button>\n              </form>\n            </li>\n          </ul>\n\n          <!-- User info -->\n          <div class="mt-auto p-3 border-top border-secondary">\n            <div class="d-flex align-items-center">\n              <div class="flex-shrink-0">\n                <i class="fas fa-user-circle fa-2x text-white-50"></i>\n              </div>\n              <div class="flex-grow-1 ms-3 d-none d-md-block">\n                <small class="text-white-50">Connect\xc3\xa9 en tant que</small>\n                <div class="text-white">\n                  \n                  testuser\n                  \n                  \n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Main content -->\n      <div class="col-md-10 col-lg-10 ms-sm-auto px-md-4">\n        <!-- Top navbar -->\n        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom py-3">\n          <div class="container-fluid">\n            <button class="btn btn-outline-secondary d-md-none" type="button" data-bs-toggle="collapse"\n              data-bs-target="#sidebar">\n              <i class="fas fa-bars"></i>\n            </button>\n\n            <!-- Breadcrumb ou titre de page -->\n            <nav aria-label="breadcrumb" class="ms-3">\n              <ol class="breadcrumb mb-0">\n                <li class="breadcrumb-item">\n                  <a href="/dashboard/">Dashboard</a>\n                </li>\n                \n    <li class="breadcrumb-item"><a href="/personnes/patients/">Patients</a></li>\n    <li class="breadcrumb-item active">Doe</li>\n\n              </ol>\n            </nav>\n\n            <div class="navbar-nav ms-auto">\n              <div class="nav-item dropdown">\n                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">\n                  <i class="fas fa-bell"></i>\n                  \n                  <span class="badge bg-danger rounded-pill">0</span>\n                  \n                </a>\n                <ul class="dropdown-menu dropdown-menu-end">\n                  <li>\n                    <a class="dropdown-item" href="/rendezvous/?status=today">\n                      <i class="fas fa-user-clock me-2"></i>\n                      0 consultations\n                      aujourd\'hui\n                    </a>\n                  </li>\n                  <li>\n                    <a class="dropdown-item" href="#">\n                      <i class="fas fa-file-invoice me-2"></i>\n                      0 paiements du jour\n                    </a>\n                  </li>\n                  <li>\n                    <hr class="dropdown-divider" />\n                  </li>\n                  <li>\n                    <a class="dropdown-item" href="#">\n                      <i class="fas fa-cog me-2"></i> Param\xc3\xa8tres\n                    </a>\n                  </li>\n                </ul>\n              </div>\n\n              <!-- User dropdown -->\n              \n              <div class="nav-item dropdown">\n                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">\n                  <i class="fas fa-user-circle"></i>\n                  <span class="ms-1 d-none d-md-inline">testuser</span>\n                </a>\n                <ul class="dropdown-menu dropdown-menu-end">\n                  <li>\n                    <a class="dropdown-item" href="#">\n                      <i class="fas fa-user me-2"></i> Mon profil\n                    </a>\n                  </li>\n                  <li>\n                    <a class="dropdown-item" href="#">\n                      <i class="fas fa-cog me-2"></i> Param\xc3\xa8tres\n                    </a>\n                  </li>\n                  <li>\n                    <hr class="dropdown-divider" />\n                  </li>\n                  <li>\n                    <form method="post" action="/accounts/logout/" class="d-inline w-100">\n                      <input type="hidden" name="csrfmiddlewaretoken" value="o8KmvHC7IV3o5CZM2iHOC0s2aSntkgFNqSmTPbOCWvZa8zKDopgyBAF6FDZAsH9O">\n                      <button type="submit" class="dropdown-item text-danger">\n                        <i class="fas fa-sign-out-alt me-2"></i> D\xc3\xa9connexion\n                      </button>\n                    </form>\n                  </li>\n                </ul>\n              </div>\n              \n            </div>\n          </div>\n        </nav>\n\n        <!-- Messages Django -->\n        \n\n        <!-- Main content block -->\n        <main class="py-4">\n<div class="container-fluid">\n    <div class="d-flex justify-content-between align-items-center mb-4">\n        <h1 class="h3 mb-0">\n            <i class="fas fa-user me-2 text-primary"></i> Doe John\n        </h1>\n        <a href="/personnes/patients/" class="btn btn-outline-secondary">\n            <i class="fas fa-arrow-left me-1"></i> Retour\n        </a>\n    </div>\n\n    <div class="row">\n        <div class="col-md-6">\n            <div class="card mb-4">\n                <div class="card-header">\n                    <h5 class="mb-0">Informations Personnelles</h5>\n                </div>\n                <div class="card-body">\n                    <p><strong>Nom :</strong> Doe</p>\n                    <p><strong>Pr\xc3\xa9nom :</strong> John</p>\n                    <p><strong>T\xc3\xa9l\xc3\xa9phone :</strong> 987654321</p>\n                    <p><strong>Email :</strong> Non renseign\xc3\xa9</p>\n                    <p><strong>Date de cr\xc3\xa9ation :</strong> </p>\n                </div>\n            </div>\n        </div>\n        \n        <div class="col-md-6">\n            <div class="card">\n                <div class="card-header">\n                    <h5 class="mb-0">Actions</h5>\n                </div>\n                <div class="card-body">\n                    <div class="d-grid gap-2">\n                        <a href="/rendezvous/nouveau/" class="btn btn-success">\n                            <i class="fas fa-calendar-plus me-1"></i> Nouveau Rendez-vous\n                        </a>\n                        <a href="/medical/consultations/nouvelle/" class="btn btn-warning">\n                            <i class="fas fa-file-medical me-1"></i> Nouvelle Consultation\n                        </a>\n                        <a href="/personnes/patients/1/modifier/" class="btn btn-outline-primary">\n                            <i class="fas fa-edit me-1"></i> Modifier\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n</main>\n\n        <!-- Footer -->\n        <footer class="border-top pt-3 mt-5">\n          <div class="container-fluid">\n            <div class="row">\n              <div class="col-md-6">\n                <p class="text-muted">\n                  <small>\n                    <i class="fas fa-hospital me-1"></i>\n                    Syst\xc3\xa8me de Gestion Hospitali\xc3\xa8re \xe2\x80\xa2\n                    <span id="current-time"></span>\n                  </small>\n                </p>\n              </div>\n              <div class="col-md-6 text-end">\n                <p class="text-muted">\n                  <small>\n                    \xc2\xa9 2026 \xe2\x80\xa2\n                    <span id="user-count">\n                      Connect\xc3\xa9\n                    </span>\n                  </small>\n                </p>\n              </div>\n            </div>\n          </div>\n        </footer>\n      </div>\n    </div>\n  </div>\n\n  <!-- Scripts -->\n  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>\n  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>\n\n  <script>\n    // Toggle sidebar on mobile\n    document.addEventListener("DOMContentLoaded", function () {\n      const sidebar = document.getElementById("sidebar");\n      const sidebarToggle = document.querySelector(\n        \'[data-bs-target="#sidebar"]\'\n      );\n\n      if (sidebarToggle) {\n        sidebarToggle.addEventListener("click", function () {\n          sidebar.classList.toggle("collapse");\n          sidebar.classList.toggle("show");\n        });\n      }\n\n      // Active nav link\n      const currentPath = window.location.pathname;\n      document.querySelectorAll(".hospital-nav-link").forEach((link) => {\n        const linkHref = link.getAttribute("href");\n        if (\n          linkHref &&\n          currentPath.startsWith(linkHref) &&\n          linkHref !== "/"\n        ) {\n          link.classList.add("active");\n        }\n      });\n\n      // Mettre \xc3\xa0 jour l\'heure en temps r\xc3\xa9el\n      function updateTime() {\n        const now = new Date();\n        const timeString = now.toLocaleTimeString("fr-FR", {\n          hour: "2-digit",\n          minute: "2-digit",\n          second: "2-digit",\n        });\n        const dateString = now.toLocaleDateString("fr-FR", {\n          weekday: "long",\n          year: "numeric",\n          month: "long",\n          day: "numeric",\n        });\n\n        const timeElement = document.getElementById("current-time");\n        if (timeElement) {\n          timeElement.textContent = `${dateString} \xe2\x80\xa2 ${timeString}`;\n        }\n      }\n\n      updateTime();\n      setInterval(updateTime, 1000);\n\n      // Gestion des formulaires de d\xc3\xa9connexion\n      document\n        .querySelectorAll(".logout-form button, .dropdown-item.text-danger")\n        .forEach((button) => {\n          button.addEventListener("click", function (e) {\n            if (!confirm("\xc3\x8ates-vous s\xc3\xbbr de vouloir vous d\xc3\xa9connecter ?")) {\n              e.preventDefault();\n            }\n          });\n        });\n    });\n  </script>\n\n  \n</body>\n\n</html>'

----------------------------------------------------------------------
Ran 4 tests in 13.914s

FAILED (failures=1)
Destroying test database for alias 'default' ('test_gestion_hopital')...
 OK
System check identified no issues (0 silenced).
